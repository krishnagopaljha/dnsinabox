-- Load required modules
modules = {
    'hints > iterate',
    'predict',
    'serve_stale',
    'policy',
    'view',
    'stats',
    'http'
}

-- Root hints
hints.root('/etc/knot-resolver/root.hints')
-- Logging
log_level('info')
log_groups({'policy'})  -- for RPZ-related logging

-- Response Policy Zone (RPZ) for blocking
policy.add(
    policy.rpz(
        policy.DENY,
        '/etc/knot-resolver/blocklist.rpz',
        true  -- auto-reload on changes
    )
)

-- Networking listeners
net.listen('0.0.0.0', 53,   { kind = 'dns', freebind = false })  -- DNS
net.listen('0.0.0.0', 853,  { kind = 'tls' })                   -- DNS-over-TLS
net.listen('0.0.0.0', 8453, { kind = 'webmgmt' })               -- Web Management / Prometheus

-- Cache configuration
cache.size = 10 * MB

-- Prometheus metrics configuration
http.prometheus.namespace = 'kresd_'

-- View: Whitelist all queries from 0.0.0.0/0
view:addr('0.0.0.0/0', policy.all(policy.PASS))
